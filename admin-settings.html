<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사이트 설정 - 이온토플 관리자</title>
    
    <!-- Pretendard Font -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/admin-settings-tabs.css">
</head>
<body>
    <!-- Admin Navigation -->
    <nav class="admin-nav">
        <div class="container">
            <div class="admin-nav-brand">
                <i class="fas fa-shield-alt"></i>
                <span>이온토플 관리자</span>
            </div>
            <div class="admin-nav-menu">
                <a href="admin-dashboard.html" class="admin-nav-link">
                    <i class="fas fa-home"></i> 대시보드
                </a>
                <a href="admin-applications.html" class="admin-nav-link">
                    <i class="fas fa-clipboard-list"></i> 신청서 관리
                </a>
                <a href="admin-study.html" class="admin-nav-link">
                    <i class="fas fa-book-reader"></i> 학습 관리
                </a>
                <a href="admin-questions.html" class="admin-nav-link">
                    <i class="fas fa-puzzle-piece"></i> 문제 관리
                </a>
                <a href="admin-users.html" class="admin-nav-link">
                    <i class="fas fa-users"></i> 회원 관리
                </a>
                <a href="admin-settings.html" class="admin-nav-link active">
                    <i class="fas fa-cog"></i> 사이트 설정
                </a>
                <a href="index.html" class="admin-nav-link">
                    <i class="fas fa-globe"></i> 사이트로
                </a>
                <div class="admin-nav-user" id="adminUser">
                    <i class="fas fa-user-circle"></i>
                    <span id="adminName">관리자</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Layout with Sidebar -->
    <div class="settings-layout">
        <!-- Left Sidebar Navigation -->
        <div class="settings-sidebar">
            <div class="settings-sidebar-header">
                <h2>⚙️ 사이트 설정</h2>
                <p>사이트 운영 관리</p>
            </div>
            
            <nav class="settings-nav">
                <a href="#contracts" class="settings-nav-item active" onclick="switchTab('contracts', event)">
                    <i class="fas fa-file-contract"></i>
                    <span>계약서 관리</span>
                </a>
                <a href="#payment" class="settings-nav-item" onclick="switchTab('payment', event)">
                    <i class="fas fa-university"></i>
                    <span>입금 계좌 정보</span>
                </a>
                <a href="#support" class="settings-nav-item" onclick="switchTab('support', event)">
                    <i class="fas fa-headset"></i>
                    <span>고객 지원 정보</span>
                </a>
                <a href="#platform" class="settings-nav-item" onclick="switchTab('platform', event)">
                    <i class="fas fa-desktop"></i>
                    <span>플랫폼 접속 정보</span>
                </a>
                <a href="#usage-guide" class="settings-nav-item" onclick="switchTab('usage-guide', event)">
                    <i class="fas fa-book"></i>
                    <span>이용방법 안내</span>
                </a>
                <a href="#notices" class="settings-nav-item" onclick="switchTab('notices', event)">
                    <i class="fas fa-bullhorn"></i>
                    <span>공지사항 관리</span>
                </a>
            </nav>
        </div>

        <!-- Right Content Area -->
        <div class="settings-content">
            <!-- Tab: 계약서 관리 -->
            <div id="tab-contracts" class="settings-tab active">
                <div class="settings-tab-header">
                    <h1>📄 계약서 관리</h1>
                    <p>학생에게 제공할 계약서를 관리하세요</p>
                </div>

                <!-- Loading -->
                <div class="loading" id="contractsLoading" style="padding: 40px 20px; display: none;">
                    <div class="spinner"></div>
                    <p style="margin-top: 12px; font-size: 13px; color: #64748b;">로딩 중...</p>
                </div>

                <!-- Contract Management -->
                <div id="contractManagement">
                    
                    <!-- Active Contracts List -->
                    <div class="form-container" style="margin-bottom: 24px;">
                        <div class="form-header" style="padding: 20px; border-bottom: 1px solid #e2e8f0;">
                            <h2 style="font-size: 18px; font-weight: 600; color: #1e293b; margin: 0;">
                                <i class="fas fa-check-circle" style="color: #22c55e;"></i> 
                                활성 계약서 목록
                            </h2>
                        </div>
                        
                        <div id="activeContractsList" style="padding: 20px;">
                            <!-- Will be filled by JavaScript -->
                        </div>
                    </div>

                    <!-- Inactive Contracts (Collapsible) -->
                    <div class="form-container" style="margin-bottom: 24px;">
                        <div class="form-header" style="padding: 20px; border-bottom: 1px solid #e2e8f0; cursor: pointer;" onclick="toggleInactiveContracts()">
                            <h2 style="font-size: 18px; font-weight: 600; color: #1e293b; margin: 0; display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-archive" style="color: #94a3b8;"></i> 
                                비활성 계약서 
                                <span id="inactiveCount" style="background: #e2e8f0; color: #64748b; padding: 4px 12px; border-radius: 12px; font-size: 14px;">0개</span>
                                <i class="fas fa-chevron-down" id="inactiveToggleIcon" style="margin-left: auto; color: #94a3b8;"></i>
                            </h2>
                        </div>
                        
                        <div id="inactiveContractsList" style="display: none; padding: 20px; background: #f8fafc; border-top: 1px solid #e2e8f0;">
                            <!-- Will be filled by JavaScript -->
                        </div>
                    </div>

                    <!-- New Contract Form -->
                    <div class="form-container">
                        <div class="form-header" style="padding: 20px; border-bottom: 1px solid #e2e8f0;">
                            <h2 style="font-size: 18px; font-weight: 600; color: #1e293b; margin: 0;">
                                <i class="fas fa-plus-circle" style="color: #9480c5;"></i> 
                                새 계약서 작성
                            </h2>
                        </div>

                        <!-- Load Existing Contract Option -->
                        <div style="padding: 20px; background: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 8px; margin: 20px;">
                            <p style="font-size: 14px; color: #1e40af; font-weight: 600; margin-bottom: 12px;">
                                <i class="fas fa-lightbulb"></i> 기존 계약서를 기반으로 새 버전을 만들 수 있습니다
                            </p>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <select id="loadContractSelect" style="flex: 1; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px;">
                                    <option value="">기존 계약서 선택...</option>
                                </select>
                                <button type="button" class="btn-secondary" onclick="loadExistingContract()">
                                    <i class="fas fa-download"></i> 불러오기
                                </button>
                            </div>
                        </div>

                        <!-- Form -->
                        <div style="padding: 20px;">
                            <div class="form-group">
                                <label for="newContractVersion" style="display: flex; align-items: center; gap: 8px;">
                                    버전 
                                    <span style="background: #e0e7ff; color: #4338ca; padding: 2px 8px; border-radius: 4px; font-size: 12px;">
                                        <i class="fas fa-lock"></i> 자동 생성
                                    </span>
                                </label>
                                <input type="text" id="newContractVersion" readonly style="background: #f1f5f9; cursor: not-allowed;">
                            </div>

                            <div class="form-group">
                                <label for="newContractTitle">계약서 제목</label>
                                <input type="text" id="newContractTitle" placeholder="예: 이온토플 수강 계약서" required>
                            </div>

                            <div class="form-group">
                                <label for="newContractContent">계약서 내용</label>
                                
                                <!-- Syntax Guide -->
                                <div style="margin-bottom: 12px;">
                                    <button type="button" class="btn-outline" onclick="toggleSyntaxGuide()" style="font-size: 13px; padding: 6px 12px;">
                                        <i class="fas fa-info-circle"></i> 문법 가이드 보기
                                    </button>
                                </div>
                                
                                <div id="syntaxGuide" style="display: none; margin-bottom: 16px; padding: 16px; background: #fffbeb; border-left: 4px solid #f59e0b; border-radius: 4px; font-size: 13px; line-height: 1.6;">
                                    <p style="font-weight: 600; margin-bottom: 8px; color: #92400e;">📚 계약서 작성 문법:</p>
                                    <ul style="margin: 0; padding-left: 20px;">
                                        <li><code>{변수명}</code> - 자동 변수 (예: {name}, {final_price})</li>
                                        <li><code>{{input:필드ID:안내문구}}</code> - 자유 입력 칸</li>
                                        <li><code>{{copy:내용}}</code> - 따라쓰기 칸</li>
                                    </ul>
                                    <p style="margin-top: 8px; color: #92400e; font-size: 12px;">
                                        💡 사용 가능한 변수: name, email, phone, assigned_program, schedule_start, schedule_end, final_price, contract_date
                                    </p>
                                </div>
                                
                                <textarea id="newContractContent" rows="20" placeholder="계약서 내용을 입력하세요..." required style="font-family: 'Pretendard', sans-serif; font-size: 14px; line-height: 1.8;"></textarea>
                            </div>

                            <div style="display: flex; gap: 12px; justify-content: flex-end;">
                                <button type="button" class="btn-secondary" onclick="previewNewContract()">
                                    <i class="fas fa-eye"></i> 미리보기
                                </button>
                                <button type="button" class="btn-primary" onclick="saveNewContract()">
                                    <i class="fas fa-save"></i> 등록하기
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview Modal -->
            <div id="previewModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 9999; overflow-y: auto;">
                <div style="max-width: 900px; margin: 40px auto; background: white; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <div style="padding: 24px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                        <h2 style="font-size: 20px; font-weight: 700; margin: 0;">
                            <i class="fas fa-eye"></i> 계약서 미리보기
                        </h2>
                        <button onclick="closePreview()" style="background: none; border: none; font-size: 24px; color: #64748b; cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="previewContent" style="padding: 40px; max-height: 70vh; overflow-y: auto;">
                        <!-- Preview content will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Tab: 입금 계좌 정보 -->
            <div id="tab-payment" class="settings-tab">
                <div class="settings-tab-header">
                    <h1>💳 입금 계좌 정보</h1>
                    <p>학생들에게 안내되는 입금 계좌 정보입니다</p>
                </div>

                <div class="form-container">
                    <div class="form-group">
                        <label for="bankName">은행명</label>
                        <input type="text" id="bankName" placeholder="예: 국민은행" required>
                    </div>

                    <div class="form-group">
                        <label for="accountNumber">계좌번호</label>
                        <input type="text" id="accountNumber" placeholder="예: 123-456-789012" required>
                    </div>

                    <div class="form-group">
                        <label for="accountHolder">예금주</label>
                        <input type="text" id="accountHolder" placeholder="예: 김민서" required>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-primary" onclick="savePaymentInfo()">
                            <i class="fas fa-save"></i> 저장하기
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab: 고객 지원 정보 -->
            <div id="tab-support" class="settings-tab">
                <div class="settings-tab-header">
                    <h1>📞 고객 지원 정보</h1>
                    <p>학생 문의 시 안내되는 연락처 정보입니다</p>
                </div>

                <div class="form-container">
                    <div class="form-group">
                        <label for="supportPhone">대표 전화번호</label>
                        <input type="tel" id="supportPhone" placeholder="예: 010-1234-5678" required>
                    </div>

                    <div class="form-group">
                        <label for="supportEmail">이메일</label>
                        <input type="email" id="supportEmail" placeholder="예: support@iontoefl.com" required>
                    </div>

                    <div class="form-group">
                        <label for="kakaoLink">카카오톡 채널 URL</label>
                        <input type="url" id="kakaoLink" placeholder="예: http://pf.kakao.com/_FWxcZC" required>
                        <small style="color: #64748b;">카카오톡 채널 관리자센터에서 URL을 복사하세요</small>
                    </div>

                    <div class="form-group">
                        <label for="businessHours">운영 시간</label>
                        <input type="text" id="businessHours" placeholder="예: 평일 09:00 - 18:00" required>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-primary" onclick="saveSupportInfo()">
                            <i class="fas fa-save"></i> 저장하기
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab: 플랫폼 접속 정보 -->
            <div id="tab-platform" class="settings-tab">
                <div class="settings-tab-header">
                    <h1>📡 플랫폼 접속 정보</h1>
                    <p>학생들에게 안내되는 학습 플랫폼 로그인 정보를 관리하세요</p>
                </div>

                <div class="form-container">
                    <div style="padding: 16px 20px; background: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 0 8px 8px 0; margin-bottom: 24px;">
                        <p style="font-size: 14px; color: #1e40af; margin: 0;">
                            <i class="fas fa-info-circle"></i>
                            여기서 설정한 정보는 학생 승인 시 안내 메시지와 대시보드에 표시됩니다.
                        </p>
                    </div>

                    <div class="form-group">
                        <label for="platformUrl">
                            <i class="fas fa-link" style="color: #6366f1;"></i> 플랫폼 URL
                        </label>
                        <input type="url" id="platformUrl" placeholder="예: https://study.iontoefl.com">
                        <small style="color: #64748b;">학생이 접속하는 학습 플랫폼 주소입니다</small>
                    </div>

                    <div class="form-group">
                        <label for="platformLoginId">
                            <i class="fas fa-user" style="color: #6366f1;"></i> 기본 로그인 ID 안내
                        </label>
                        <input type="text" id="platformLoginId" placeholder="예: 학생 이메일 주소와 동일">
                        <small style="color: #64748b;">학생에게 안내할 로그인 ID 규칙 (예: 이메일, 이름 등)</small>
                    </div>

                    <div class="form-group">
                        <label for="platformLoginPw">
                            <i class="fas fa-key" style="color: #6366f1;"></i> 기본 비밀번호 안내
                        </label>
                        <input type="text" id="platformLoginPw" placeholder="예: 초기 비밀번호 1234 (로그인 후 변경)">
                        <small style="color: #64748b;">학생에게 안내할 초기 비밀번호 또는 안내 문구</small>
                    </div>

                    <div class="form-group">
                        <label for="platformLoginGuide">
                            <i class="fas fa-clipboard-list" style="color: #6366f1;"></i> 로그인 상세 안내
                        </label>
                        <textarea id="platformLoginGuide" rows="6" placeholder="로그인 방법에 대한 상세 안내를 입력하세요...&#10;&#10;예:&#10;1. 위 URL에 접속하세요.&#10;2. 이메일 주소로 로그인하세요.&#10;3. 초기 비밀번호는 별도 이메일로 발송됩니다." style="font-family: 'Pretendard', sans-serif; font-size: 14px; line-height: 1.6;"></textarea>
                        <small style="color: #64748b;">줄바꿈을 포함한 상세 안내 문구 (승인 메시지에 포함됩니다)</small>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-primary" onclick="savePlatformInfo()">
                            <i class="fas fa-save"></i> 저장하기
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab: 공지사항 관리 -->
            <div id="tab-notices" class="settings-tab">
                <div class="settings-tab-header">
                    <h1>📢 공지사항 관리</h1>
                    <p>테스트룸 학습일정 화면에 표시되는 공지사항을 관리하세요</p>
                </div>

                <!-- 공지 등록/수정 폼 -->
                <div class="form-container" id="noticeFormContainer" style="margin-bottom: 24px; display: none;">
                    <div class="form-header" style="padding: 20px; border-bottom: 1px solid #e2e8f0;">
                        <h2 id="noticeFormTitle" style="font-size: 18px; font-weight: 600; color: #1e293b; margin: 0;">
                            <i class="fas fa-plus-circle" style="color: #3b82f6;"></i> 공지 등록
                        </h2>
                    </div>
                    <div style="padding: 20px;">
                        <input type="hidden" id="noticeEditId" value="">
                        
                        <div class="form-group" style="margin-bottom: 16px;">
                            <label style="font-weight: 600; font-size: 14px; color: #334155; margin-bottom: 6px; display: block;">타입</label>
                            <select id="noticeType" onchange="updateNoticePreview()" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; font-family: 'Pretendard', sans-serif;">
                                <option value="urgent">🚨 긴급 공지</option>
                                <option value="notice" selected>📢 일반 공지</option>
                                <option value="deadline">⏰ 마감 안내</option>
                                <option value="tip">💡 팁 / 도움말</option>
                                <option value="update">🔄 업데이트</option>
                                <option value="event">🎉 이벤트</option>
                                <option value="warning">⚠️ 주의사항</option>
                                <option value="check">✅ 완료 / 확인</option>
                            </select>
                        </div>

                        <div class="form-group" style="margin-bottom: 16px;">
                            <label style="font-weight: 600; font-size: 14px; color: #334155; margin-bottom: 6px; display: block;">제목</label>
                            <input type="text" id="noticeTitle" oninput="updateNoticePreview()" placeholder="공지 제목을 입력하세요" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; font-family: 'Pretendard', sans-serif; box-sizing: border-box;">
                        </div>

                        <div class="form-group" style="margin-bottom: 16px;">
                            <label style="font-weight: 600; font-size: 14px; color: #334155; margin-bottom: 6px; display: block;">내용</label>
                            <textarea id="noticeContent" oninput="updateNoticePreview()" rows="4" placeholder="공지 내용을 입력하세요. HTML &lt;b&gt;태그 사용 가능" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; font-family: 'Pretendard', sans-serif; resize: vertical; box-sizing: border-box;"></textarea>
                        </div>

                        <div style="display: flex; gap: 16px; margin-bottom: 16px;">
                            <div class="form-group" style="flex: 1;">
                                <label style="font-weight: 600; font-size: 14px; color: #334155; margin-bottom: 6px; display: block;">순서</label>
                                <input type="number" id="noticeSortOrder" value="0" min="0" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; font-family: 'Pretendard', sans-serif; box-sizing: border-box;">
                                <small style="color: #64748b;">숫자가 작을수록 위에 표시</small>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label style="font-weight: 600; font-size: 14px; color: #334155; margin-bottom: 6px; display: block;">활성 상태</label>
                                <label style="display: flex; align-items: center; gap: 8px; margin-top: 8px; cursor: pointer;">
                                    <input type="checkbox" id="noticeIsActive" checked style="width: 18px; height: 18px; cursor: pointer;">
                                    <span style="font-size: 14px; color: #475569;">테스트룸에 표시</span>
                                </label>
                            </div>
                        </div>

                        <!-- 미리보기 -->
                        <div style="margin-bottom: 16px;">
                            <label style="font-weight: 600; font-size: 14px; color: #334155; margin-bottom: 8px; display: block;">📱 테스트룸 미리보기</label>
                            <div id="noticePreview" style="border: 1px dashed #d1d5db; border-radius: 12px; padding: 16px; min-height: 60px;">
                                <p style="color: #94a3b8; text-align: center; margin: 0;">위에 내용을 입력하면 미리보기가 표시됩니다</p>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button type="button" onclick="cancelNoticeForm()" style="padding: 10px 20px; border: 1px solid #d1d5db; border-radius: 8px; background: white; color: #475569; font-size: 14px; cursor: pointer; font-family: 'Pretendard', sans-serif;">취소</button>
                            <button type="button" onclick="saveNotice()" style="padding: 10px 20px; border: none; border-radius: 8px; background: #3b82f6; color: white; font-size: 14px; cursor: pointer; font-family: 'Pretendard', sans-serif; font-weight: 600;"><i class="fas fa-save"></i> 저장</button>
                        </div>
                    </div>
                </div>

                <!-- 공지 목록 -->
                <div class="form-container">
                    <div class="form-header" style="padding: 20px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                        <h2 style="font-size: 18px; font-weight: 600; color: #1e293b; margin: 0;">
                            <i class="fas fa-list" style="color: #6366f1;"></i> 공지 목록
                            <span id="noticeCount" style="font-size: 13px; color: #94a3b8; font-weight: 400;"></span>
                        </h2>
                        <button type="button" onclick="showNoticeForm()" style="padding: 8px 16px; border: none; border-radius: 8px; background: #3b82f6; color: white; font-size: 13px; cursor: pointer; font-family: 'Pretendard', sans-serif; font-weight: 600;"><i class="fas fa-plus"></i> 새 공지 등록</button>
                    </div>
                    <div id="noticeList" style="padding: 20px;">
                        <div style="text-align: center; padding: 40px 0; color: #94a3b8;">로딩 중...</div>
                    </div>
                </div>
            </div>

            <!-- Tab: 이용방법 안내 -->
            <div id="tab-usage-guide" class="settings-tab">
                <div class="settings-tab-header">
                    <h1>📖 이용방법 안내 설정</h1>
                    <p>학생들에게 제공되는 이용 가이드를 관리하세요</p>
                </div>

                <!-- Usage Guide Settings -->
                <div id="usageGuideContainer">
                    <!-- Will be loaded from existing admin-settings.js -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/supabase-config.js"></script>
    <script src="js/admin-utils.js"></script>
    <script src="js/contract-utils.js"></script>
    <script src="js/admin-settings-tabs.js"></script>
    <script src="js/admin-contracts.js"></script>
    <script src="js/admin-notices.js"></script>
</body>
</html>
